{% extends "base.html" %}

{% block body %}
 <div class="container">
    <section class="breadcrumbs">
        <a href="{{url('home')}}">Search Home </a> &gt; Search For:
        {{request.GET.q|default("No Search")}}
    </section>
</div>

<div class="search">
    <div class="container">


        <section class="recordsearch--content">

          <form class="recordsearch" method="get" action=".">
            <div class="recordsearch--box">
              <form id="search">
                <div class="search-icon"><span class="fa fa-search"></span></div>
                <input id="query id_q" name="q" type="search" value="{{request.GET.q}}" />
                <input class="submit" type="submit" value="Search">
              </form>
            </div>
            <div class="recordsearch--filter">
                <h4>Filter by Agency</h4>
                <select>
                {% if facets.fields.foia_agency %}
                {% for agency in facets.fields.foia_agency %}
                        {% if "foia_agency_exact" not in request.GET.urlencode() %}
                            <option value="{{agency.0|upper}}">{{agency.0|upper}}</option>
                            <!--<a href="?{{remove_from_query(request.GET.urlencode(), ['page'])}}&amp;selected_facets=foia_agency_exact:{{agency.0|urlencode}}">{{agency.0|upper}}</a>-->
                            ({{ agency.1 }})
                        {% else %}
                            {{agency.0|replace("-", " ")}} ({{ agency.1 }})
                        {% endif %}
                {% endfor %}
                {% endif %}
                </select>
            </div>
          </form>
        </section>
    </div>
</div>

<div class="container">
    <section class="searchresults--records">
    {% if query %}
        <header class="clearfix">
            <h1><em>{{page.paginator.count}} results for &ldquo;{{request.GET.q}}&rdquo;</em></h1>

            <div class="searchresults--sort">
                <dl>
                    <dd>
                        {% if request.GET.order_by == 'date_released' %}
                            <a href="?{{remove_from_query(request.GET.urlencode(), ['order_by', 'page'])}}&amp;order_by=relevance">Order by relevance</a>
                        {% else %}
                            <a href="?{{remove_from_query(request.GET.urlencode(), ['order_by', 'page'])}}&amp;order_by=date_released">Order by release date</a>
                        {% endif %}
                    </dd>
                </dl>
            </div>
        </header>

        <ul class="searchresults--list">
        {% for result in page.object_list %}

            {% include 'search/search_result.html' %}

        {% else %}
            <p>No results found</p>
        {% endfor %}
        </ul>

        {% if page.has_previous() or page.has_next() %}
            <div>
                {% if page.has_previous() %}
                    <a href="?{{remove_from_query(request.GET.urlencode(), ['page'])}}&amp;page={{page.previous_page_number()}}">{%endif%}&laquo; Previous {% if page.has_previous%}</a>
                {% endif %}
                {% if page.has_next() %}
                    | <a href="?{{remove_from_query(request.GET.urlencode(), ['page'])}}&amp;page={{page.next_page_number()}}">{%endif%} Next &raquo;{% if page.has_next%}</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}

    {# Show some example queries to run, maybe query syntax, something else? #}
    {% endif %}
    </section>
</div>
{% endblock %}
